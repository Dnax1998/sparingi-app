<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil ‚Äì ZgranyTrener.pl</title>
  <link rel="stylesheet" href="style-profil.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"></script>
</head>
<body>
  <header>
    <div class="logo" style="position: absolute; top: 10px; left: 20px; display: flex; align-items: center;">
      <img src="logo.png" alt="Logo ZgranyTrener.pl" height="50" />
      <span style="color: white; font-weight: 700; font-size: 18px; margin-left: 10px;">ZgranyTrener.pl</span>
    </div>
  </header>

  <main class="profil-container">
    <a href="dashboard.html" class="back-btn">‚Üê Powr√≥t</a>

    <div class="avatar-container">
      <img id="user-avatar" src="avatar1.png" alt="Avatar" class="avatar" />
      <button id="change-avatar" class="change-avatar-btn">Zmie≈Ñ avatar</button>
    </div>

    <h1 id="user-name">U≈ºytkownik</h1>
    <p class="role">Trener</p>

    <section class="stats">
      <div class="info-box">
        <h3>Klub</h3>
        <p id="club-display">Brak</p>
        <span id="edit-club" class="edit-icon">‚úèÔ∏è</span>
      </div>
      <div class="info-box">
        <h3>Kategorie wiekowe</h3>
        <p id="categories-display">Brak</p>
        <span id="edit-categories" class="edit-icon">‚úèÔ∏è</span>
      </div>
    </section>

    <section class="match-stats">
      <div class="match-box">
        <h4>16</h4>
        <p>Rozegrane sparingi</p>
      </div>
      <div class="match-box">
        <h4>4</h4>
        <p>Zaplanowane sparingi</p>
      </div>
    </section>

    <section class="recent-matches">
      <h3>Ostatnie sparingi</h3>
      <table>
        <tr><th>Data</th><th>Kategoria</th><th>Mecz</th></tr>
        <tr><td>13.04.2024</td><td>U11</td><td>AP M≈Çodziaki vs UKS Wilan√≥w</td></tr>
        <tr><td>06.04.2024</td><td>U9</td><td>FC Talent vs AP M≈Çodziaki</td></tr>
        <tr><td>24.03.2024</td><td>U12</td><td>AP M≈Çodziaki vs MKS Delta</td></tr>
      </table>
    </section>
  </main>

  <!-- Modal do wyboru kategorii -->
  <div id="category-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>Wybierz kategorie wiekowe</h3>
      <div id="category-options"></div>
      <button id="save-categories" class="save-btn">Zapisz</button>
    </div>
  </div>

  <style>
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-content {
      background: white;
      border-radius: 10px;
      padding: 20px;
      width: 300px;
      text-align: center;
    }
    .modal-content h3 {
      margin-bottom: 10px;
    }
    .modal-content label {
      display: block;
      text-align: left;
    }
    .save-btn {
      background: #1e7e34;
      color: white;
      border: none;
      padding: 8px 14px;
      margin-top: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .save-btn:hover {
      background: #28a745;
    }
    .match-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 20px;
    }
    .match-box {
      background: rgba(0,0,0,0.3);
      color: white;
      border-radius: 15px;
      padding: 20px 40px;
      text-align: center;
      min-width: 200px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .match-box h4 {
      font-size: 32px;
      margin: 0;
    }
    .match-box p {
      margin: 5px 0 0;
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // üî• Twoja konfiguracja Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBXwR3VojWtQLA6FsXj2pVQsSTWNNAUhb0",
      authDomain: "sparingi-app.firebaseapp.com",
      projectId: "sparingi-app",
      storageBucket: "sparingi-app.firebasestorage.app",
      messagingSenderId: "293859421755",
      appId: "1:293859421755:web:e98887fdc5fb4a79aef61e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const userName = document.getElementById("user-name");
    const avatarEl = document.getElementById("user-avatar");
    const changeBtn = document.getElementById("change-avatar");
    const clubDisplay = document.getElementById("club-display");
    const clubEdit = document.getElementById("edit-club");
    const categoriesDisplay = document.getElementById("categories-display");
    const categoriesEdit = document.getElementById("edit-categories");

    const modal = document.getElementById("category-modal");
    const optionsContainer = document.getElementById("category-options");
    const saveBtn = document.getElementById("save-categories");

    const avatars = ["avatar1.png", "avatar2.png"];

    const allCategories = ["U6","U7","U8","U9","U10","U11","U12","U13","U14","U15","U16","U17","U18","U19"];

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "index.html";
        return;
      }

      userName.textContent = user.displayName || "Trener";

      const userRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(userRef);

      if (docSnap.exists()) {
        const data = docSnap.data();
        clubDisplay.textContent = data.club || "Brak";
        categoriesDisplay.textContent = data.categories?.join(", ") || "Brak";
        avatarEl.src = data.avatar || "avatar1.png";
      } else {
        await setDoc(userRef, { club: "", categories: [], avatar: "avatar1.png" });
      }

      // üîÑ zmiana avatara
      changeBtn.addEventListener("click", async () => {
        const current = avatarEl.src.split("/").pop();
        const next = avatars[(avatars.indexOf(current) + 1) % avatars.length];
        avatarEl.src = next;
        await updateDoc(userRef, { avatar: next });
      });

      // ‚úèÔ∏è edycja klubu
      clubEdit.addEventListener("click", async () => {
        const newClub = prompt("Wpisz nazwƒô klubu:", clubDisplay.textContent);
        if (newClub) {
          clubDisplay.textContent = newClub;
          await updateDoc(userRef, { club: newClub });
        }
      });

      // üßí wyb√≥r kategorii (popup)
      categoriesEdit.addEventListener("click", async () => {
        modal.style.display = "flex";
        optionsContainer.innerHTML = "";
        allCategories.forEach(cat => {
          const div = document.createElement("label");
          const input = document.createElement("input");
          input.type = "checkbox";
          input.value = cat;
          if (categoriesDisplay.textContent.includes(cat)) input.checked = true;
          div.appendChild(input);
          div.appendChild(document.createTextNode(" " + cat));
          optionsContainer.appendChild(div);
        });
      });

      saveBtn.addEventListener("click", async () => {
        const checked = [...optionsContainer.querySelectorAll("input:checked")].map(i => i.value);
        categoriesDisplay.textContent = checked.join(", ") || "Brak";
        modal.style.display = "none";
        await updateDoc(userRef, { categories: checked });
      });

      // zamykanie modala po klikniƒôciu w t≈Ço
      modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.style.display = "none";
      });
    });
  </script>
</body>
</html>
