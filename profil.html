<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil - ZgranyTrener.pl</title>
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="../style-profil.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <header class="navbar">
  <div class="logo-container">
<img src="../img/logo.png" alt="Logo ZgranyTrener.pl" height="50">

    <span class="logo-text">ZgranyTrener.pl</span>
  </div>
</header>


  <main class="profil-container">
    <a href="dashboard.html" class="back-btn">‚Üê Powr√≥t</a>
    <img src="profil/avatar.png" alt="Avatar" class="avatar">

    <h1 id="user-name">
      <span id="name-display">Adam Nowak</span>
      <span id="edit-name" class="edit-icon" title="Edytuj imiƒô i nazwisko">‚úèÔ∏è</span>
    </h1>
    <p class="role">Trener</p>

    <section class="stats">
      <div class="info-box">
        <h3>Klub</h3>
        <p id="club-display">AP M≈Çodziaki</p>
        <span id="edit-club" class="edit-icon" title="Edytuj klub">‚úèÔ∏è</span>
      </div>
      <div class="info-box">
        <h3>Kategorie wiekowe</h3>
        <p id="categories-display">U9, U11, U12</p>
        <span id="edit-categories" class="edit-icon" title="Edytuj kategorie wiekowe">‚úèÔ∏è</span>
      </div>
    </section>

    <section class="stats">
      <div class="info-box">
        <h2>16</h2>
        <p>Rozegrane sparingi</p>
      </div>
      <div class="info-box">
        <h2>4</h2>
        <p>Zaplanowane sparingi</p>
      </div>
    </section>

    <section class="recent-matches">
      <h3>Ostatnie sparingi</h3>
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Kategoria</th>
            <th>Mecz</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>13.04.2024</td>
            <td>U11</td>
            <td>AP M≈Çodziaki vs UKS Wilan√≥w</td>
          </tr>
          <tr>
            <td>06.04.2024</td>
            <td>U9</td>
            <td>FC Talent vs AP M≈Çodziaki</td>
          </tr>
          <tr>
            <td>24.03.2024</td>
            <td>U12</td>
            <td>AP M≈Çodziaki vs MKS Delta</td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <!-- üîí Zabezpieczenie strony przed wej≈õciem bez logowania -->
  <script src="auth-check.js"></script>

  <!-- üöÄ Po≈ÇƒÖczenie z Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyBXwR3VojWtQLA6FsXj2pVQsSTWNNAUhb0",
  authDomain: "sparingi-app.firebaseapp.com",
  projectId: "sparingi-app",
  storageBucket: "sparingi-app.firebasestorage.app",
  messagingSenderId: "293859421755",
  appId: "1:293859421755:web:e98887fdc5fb4a79aef61e"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // üîí Sprawdzenie logowania
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const userRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(userRef);

      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("name-display").textContent = data.name || user.displayName || "Brak";
        document.getElementById("club-display").textContent = data.club || "Brak";
        document.getElementById("categories-display").textContent = (data.categories || []).join(", ");
      } else {
        await setDoc(userRef, { name: user.displayName || "", club: "", categories: [] });
      }

      // Funkcja zapisu
      window.saveProfileData = async (newData) => {
        await setDoc(userRef, newData, { merge: true });
      };
    });
  </script>

  <!-- ‚úèÔ∏è Skrypt do edycji profilu -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const nameDisplay = document.getElementById("name-display");
      const editNameBtn = document.getElementById("edit-name");
      const clubDisplay = document.getElementById("club-display");
      const editClubBtn = document.getElementById("edit-club");
      const categoriesDisplay = document.getElementById("categories-display");
      const editCategoriesBtn = document.getElementById("edit-categories");

      // --- Edycja imienia ---
      editNameBtn.addEventListener("click", () => {
        const input = document.createElement("input");
        input.type = "text";
        input.value = nameDisplay.textContent;
        nameDisplay.replaceWith(input);
        input.focus();

        const save = async () => {
          const newName = input.value.trim() || "Bez imienia";
          const span = document.createElement("span");
          span.id = "name-display";
          span.textContent = newName;
          input.replaceWith(span);
          if (window.saveProfileData) saveProfileData({ name: newName });
        };

        input.addEventListener("blur", save);
        input.addEventListener("keydown", (e) => { if (e.key === "Enter") save(); });
      });

      // --- Edycja klubu ---
      editClubBtn.addEventListener("click", () => {
        const newVal = prompt("Podaj nazwƒô klubu:", clubDisplay.textContent);
        if (newVal && newVal.trim() !== "") {
          clubDisplay.textContent = newVal;
          if (window.saveProfileData) saveProfileData({ club: newVal });
        }
      });

      // --- Kategorie wiekowe ---
      editCategoriesBtn.addEventListener("click", () => {
        const options = ["U6","U7","U8","U9","U10","U11","U12","U13","U14","U15","U16","U17","U18","U19"];
        const current = categoriesDisplay.textContent.split(", ").filter(Boolean);
        const overlay = document.createElement("div");
        overlay.style.cssText = "position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;";
        const box = document.createElement("div");
        box.style.cssText = "background:#004d00;padding:25px 35px;border-radius:16px;color:white;font-family:'Montserrat',sans-serif;font-size:16px;";
        box.innerHTML = "<h3 style='text-align:center;margin-bottom:15px;'>Wybierz kategorie wiekowe:</h3>";

        options.forEach(opt => {
          const label = document.createElement("label");
          label.style.display = "block";
          label.style.marginBottom = "6px";
          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.value = opt;
          cb.style.marginRight = "8px";
          if (current.includes(opt)) cb.checked = true;
          label.append(cb, opt);
          box.append(label);
        });

        const btns = document.createElement("div");
        btns.style.cssText = "display:flex;gap:10px;margin-top:20px;";
        const saveBtn = document.createElement("button");
        saveBtn.textContent = "Zapisz";
        saveBtn.style.cssText = "flex:1;padding:8px;border:none;background:#e63946;color:#fff;border-radius:8px;cursor:pointer;";
        const cancelBtn = document.createElement("button");
        cancelBtn.textContent = "Anuluj";
        cancelBtn.style.cssText = "flex:1;padding:8px;border:none;background:#444;color:#fff;border-radius:8px;cursor:pointer;";
        btns.append(saveBtn, cancelBtn);
        box.append(btns);
        overlay.append(box);
        document.body.append(overlay);

        saveBtn.onclick = () => {
          const selected = [...box.querySelectorAll("input:checked")].map(cb => cb.value);
          categoriesDisplay.textContent = selected.join(", ");
          document.body.removeChild(overlay);
          if (window.saveProfileData) saveProfileData({ categories: selected });
        };
        cancelBtn.onclick = () => document.body.removeChild(overlay);
      });
    });
  </script>
</body>
</html>
